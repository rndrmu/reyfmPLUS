// ==UserScript==
// @name         reyfmPLUS
// @namespace    https://github.com
// @version      1.0.0
// @description  ReyFM++
// @author       
// @match        https://rey.fm/*
// @grant        none
// ==/UserScript==
(()=>{function c(n,s,t,e,o){let a=n.cloneNode(!0);return a.childNodes[0].textContent=s,a.style.backgroundColor=t,a.style.color="#ffffff",a.style.marginTop=e?"10px":"0px",a.style.paddingLeft="10px",a.style.paddingRight="10px",a.style.borderRadius="10px",a.style.fontSize="12px",a.addEventListener("click",o),a}function p(n,s){new MutationObserver((t,e)=>{let o=document.querySelectorAll(n)[0];o&&o.offsetParent!==null&&(s(o),e.disconnect())}).observe(document,{childList:!0,subtree:!0})}function y(){let n=document.querySelectorAll("p[data-v-5fde3039]")[0].textContent?.trim(),s=document.querySelectorAll("p[data-v-5fde3039]")[1].textContent?.trim(),t=`https://open.spotify.com/search/${n} ${s}`;window.open(t,"_blank")}function f(){let n=document.querySelectorAll("div.base-container")[4],t=n.childNodes[2].cloneNode(!0);t.childNodes[0].textContent="ReyfmPlus",t.querySelector("div > a > p").textContent=`A script to enhance the rey.fm experience

 Version: 1.0`,t.querySelector("div > a > p").innerHTML=t.querySelector("div > a > p").innerHTML.replace(/\n/g,"<br>"),t.querySelector("div > a").removeAttribute("href"),n.insertBefore(t,n.childNodes[5])}function l(n){window.__NUXT__.state.player.audio.pause(),window.__NUXT__.state.player.audio=null,window.__NUXT__.state.player.audio=n,window.__NUXT__.state.player.audio?.play()}function h(n){new MutationObserver((s,t)=>{window.__NUXT__.state.player.playing?(window.__NUXT__.state.player.audio&&l(window.rfmPlusState.audioPlayer),n.volume=window.__NUXT__.state.player.volume/100):(window.__NUXT__.state.player.audio&&l(n),window.__NUXT__.state.player.audio=null,window.rfmPlusState.audioPlayer?.pause(),window.__NUXT__.state.player.audio?.pause(),n.volume=window.__NUXT__.state.player.volume/100)}).observe(document,{childList:!0,subtree:!0})}function w(n,s){let t=window.location.pathname;new MutationObserver((e,o)=>{window.location.pathname!==t&&(t=window.location.pathname,m(t))}).observe(document,{childList:!0,subtree:!0})}function m(n){if(console.log("[REYFMPLUS] New path: "+n),n.startsWith("/station/"))p("div.name",s=>{let t=s.parentElement,e=s;e.childNodes[0].textContent=e.childNodes[0].textContent+" \u2014 ReyfmPlusEnhanced";let o=c(s,"Bass Boost Menu","#ff0000",!0,()=>{console.log("clicked boost chip"),b()});if(t.appendChild(o),!window.rfmPlusState.bassBoostActive){let a=c(s,"Bass Boost Active (Lvl: "+window.rfmPlusState.bassBoostLevel+")","#ff0000",!0,()=>{console.log("clicked boost active chip")});t.appendChild(a)}});else if(new URLSearchParams(window.location.search).get("rfmPlusSettings")){console.log(new URLSearchParams(window.location.search));let s=document.getElementsByTagName("body")[0],t=document.createElement("img");t.src="https://i.redd.it/wisxmib7ho9a1.png",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="10%",t.style.height="10%",t.style.zIndex="9999999999999999",s.appendChild(t);let e=document.createElement("p");e.style.position="fixed",e.textContent="there isn't anything here yet, click the okuu in the top left to go back",e.style.top="10%",e.style.left="10%",e.style.zIndex="9999999999999999",e.style.color="white",e.style.fontSize="2em"}}window.rfmPlusState={bassBoostActive:!1,bassBoostLevel:0,audioContext:void 0,audioPlayer:void 0};p("div[data-v-733b83fc] > a > svg",n=>{console.info("[REYFMPLUS] Hello from ReyfmPlus!"),v()});function v(){console.log("[REYFMPLUS] Starting main script"),console.log("[REYFMPLUS] Current state: "+window.__NUXT__),f(),m(window.location.pathname),w(window.location.pathname,m),p("a[data-v-5fde3039] > div.w-max > p.akira",n=>{let t=n.parentElement?.parentElement,e=c(n,"On Spotify","#1db954",!1,o=>{o.preventDefault(),y()});t.appendChild(e)})}function b(){window.__NUXT__.state.player.audio&&l(window.rfmPlusState.audioPlayer);let n=location.pathname.split("/")[2],s=g[n];console.log("[REYFMPLUS] Station ID: "+s),console.log("[REYFMPLUS] Bass boost menu for station: "+n),window.__NUXT__.state.player.currentStation=s;let t=`https://listen.reyfm.de/${n}_320kbps.mp3`,e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.5)";let o=document.createElement("div");o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)",o.style.backgroundColor="#ffffff",o.style.padding="20px",o.style.borderRadius="10px",o.style.width="80%",o.style.maxWidth="500px",o.style.height="80%",o.style.maxHeight="500px",o.style.overflow="auto",o.style.boxShadow="0 0 10px 0 rgba(0, 0, 0, 0.5)",o.textContent="REYFMPlus \u2014 Bass Boost Menu",o.style.fontSize="20px",o.style.fontWeight="bold",o.style.textAlign="center",o.style.marginBottom="20px",document.body.appendChild(e),e.appendChild(o),[{name:"Normal",description:"No bass boost",value:0},{name:"Regular Bass Boost",description:"A regular bass boost, nothing fancy",value:1},{name:"Heavy Bass Boost",description:"A heavy bass boost, for the bassheads",value:5},{name:"Bass Boost + Limiter",description:"A regular bass boost with a limiter to prevent clipping",value:3},{name:"Absolutely fucking crazy",description:"A heavy bass boost, why are you even using this",value:15}].forEach(r=>{let i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.marginBottom="20px",i.style.cursor="pointer";let u=document.createElement("div");u.style.fontSize="18px",u.style.fontWeight="bold",u.textContent=r.name;let d=document.createElement("div");d.style.fontSize="14px",d.style.fontWeight="normal",d.style.textAlign="center",d.textContent=r.description,i.appendChild(u),i.appendChild(d),i.addEventListener("click",()=>{_(t,r.value),e.remove()}),o.appendChild(i)}),e.style.display="block",e.addEventListener("click",r=>{r.target===e&&e.remove()})}var g={original:1,nightlife:2,raproyal:3,usrap:4,hitsonly:5,gaming:6,houseparty:7,chillout:8,lofi:9,oldschool:10,mashup:11,charts:12,partyhard:13,bass:14,kpop:15,xmas:20};function _(n="https://listen.reyfm.de/original_320kbps.mp3",s=1){let t=new window.AudioContext,e=new Audio;e.src=n,e.crossOrigin="anonymous";let o=t.createMediaElementSource(e),a=t.createBiquadFilter();a.type="lowshelf",a.frequency.value=1e3,a.gain.value=s,o.connect(a),a.connect(t.destination),window.__NUXT__.state.player.playing=!0,window.__NUXT__.state.player.audio&&l(e),window.rfmPlusState.audioPlayer=e,window.rfmPlusState.audioContext=t,window.__NUXT__.state.player.audio=e,h(e)}})();
/*! For license information please see reyfm.user.js.LEGAL.txt */
