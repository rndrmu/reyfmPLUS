// ==UserScript==
// @name         reyfm-plus
// @namespace    https://github.com
// @version      1.0.0
// @description  ReyFM++
// @author       
// @match        https://rey.fm/*
// @grant        none
// ==/UserScript==
(()=>{function c(t,e,o,a,n){let s=t.cloneNode(!0);return s.childNodes[0].textContent=e,s.style.backgroundColor=o,s.style.color="#ffffff",s.style.marginTop=a?"10px":"0px",s.style.paddingLeft="10px",s.style.paddingRight="10px",s.style.borderRadius="10px",s.style.fontSize="12px",s.addEventListener("click",n),s}function u(t,e){new MutationObserver((o,a)=>{let n=document.querySelectorAll(t)[0];n&&n.offsetParent!==null&&(e(n),a.disconnect())}).observe(document,{childList:!0,subtree:!0})}function C(){let t=document.querySelectorAll("p[data-v-5fde3039]")[0].textContent?.trim(),e=document.querySelectorAll("p[data-v-5fde3039]")[1].textContent?.trim(),o=`https://open.spotify.com/search/${t} ${e}`;window.open(o,"_blank")}function k(){let t=document.querySelectorAll("div.base-container")[4],o=t.childNodes[2].cloneNode(!0);o.childNodes[0].textContent="ReyfmPlus",o.querySelector("div > a > p").textContent=`A script to enhance the rey.fm experience

 Version: 1.0`,o.querySelector("div > a > p").innerHTML=o.querySelector("div > a > p").innerHTML.replace(/\n/g,"<br>"),o.querySelector("div > a").removeAttribute("href"),t.insertBefore(o,t.childNodes[5])}function r(t){window.__NUXT__.state.player.audio.pause(),window.__NUXT__.state.player.audio=null,window.__NUXT__.state.player.audio=t,window.__NUXT__.state.player.audio?.play()}function f(t){new MutationObserver((e,o)=>{window.__NUXT__.state.player.playing?(window.__NUXT__.state.player.audio&&r(window.rfmPlus.state.audioPlayer),t.volume=window.__NUXT__.state.player.volume/100):(window.__NUXT__.state.player.audio&&r(t),window.__NUXT__.state.player.audio=null,window.rfmPlus.state.audioPlayer?.pause(),window.__NUXT__.state.player.audio?.pause(),t.volume=window.__NUXT__.state.player.volume/100)}).observe(document,{childList:!0,subtree:!0})}function B(t,e){let o=window.location.pathname;new MutationObserver((a,n)=>{window.location.pathname!==o&&(o=window.location.pathname,g(o))}).observe(document,{childList:!0,subtree:!0})}function g(t){console.log("[REYFMPLUS] New path: "+t),t.startsWith("/station/")&&u("div.name",e=>{let o=e.parentElement,a=e;a.childNodes[0].textContent=a.childNodes[0].textContent+" \u2014 ReyfmPlusEnhanced";let n=c(e,"Bass Boost Menu","#ff0000",!0,()=>{console.log("clicked boost chip"),S()});if(o.appendChild(n),!window.rfmPlus.state.bassBoostActive){let s=c(e,"Bass Boost Active (Lvl: "+window.rfmPlus.state.bassBoostLevel+")","#ff0000",!0,()=>{console.log("clicked boost active chip")});o.appendChild(s)}})}var _={original:1,nightlife:2,raproyal:3,usrap:4,hitsonly:5,gaming:6,houseparty:7,chillout:8,lofi:9,oldschool:10,mashup:11,charts:12,partyhard:13,bass:14,kpop:15,xmas:20};function m(t){return t}function v(t,e){let o=window.__NUXT__.state.player.audio;window.__NUXT__.state.player.currentStation=t,o.src=`https://stream.reyfm.de/${t}/${e}.mp3`,o.play(),f(o)}var N={state:{bassBoostActive:!1,bassBoostLevel:0},api:{getStation:async t=>{let e=await window.rfmPlus.api.getStations();return _[t]},getStations:async()=>new Promise((t,e)=>{let o=window.__NUXT__.state.main.data.channels;o?t(o):e("Could not get stations")}),playBoosted:async(t,e)=>{window.__NUXT__.state.player.audio&&r(window.rfmPlus.state.audioPlayer),window.rfmPlus.state.bassBoostActive=!0,v(t,e)},playOriginal:async(t,e)=>{window.__NUXT__.state.player.audio&&r(window.rfmPlus.state.audioPlayer),window.rfmPlus.state.bassBoostActive=!1,v(t,e)}}};var l=class{constructor(e,o="white"){this.name=e;this.color=o}static makeTitle(e,o){return["%c %c %s ","",`background: ${e}; color: black; font-weight: bold; border-radius: 5px;`,o]}_log(e,o,a,n=""){console[e](`%c Rey.fm Plus %c %c ${this.name} ${n}`,`background: ${o}; color: black; font-weight: bold; border-radius: 5px;`,"",`background: ${this.color}; color: black; font-weight: bold; border-radius: 5px;`,...a)}log(...e){this._log("log","#a6d189",e)}info(...e){this._log("info","#a6d189",e)}error(...e){this._log("error","#e78284",e)}errorCustomFmt(e,...o){this._log("error","#e78284",o,e)}warn(...e){this._log("warn","#e5c890",e)}debug(...e){this._log("debug","#eebebe",e)}};var x=m({name:"Bass Boost",enabled:!0,author:"built-in",version:"1.0.0",description:"Adds a bass boost button to the player",entrypoint:()=>{let t=document.createElement("button");t.className="btn btn-primary btn-sm",t.innerHTML="Bass Boost",t.addEventListener("click",()=>{let e=document.querySelector("audio");e&&(e.playbackRate=1.5)}),document.querySelector(".player-controls").appendChild(t)}});var b=new l("Socket"),h=new WebSocket("ws://localhost:8080"),P=m({name:"Ranking System",enabled:!1,author:"built-in",version:"1.0.0",description:"Adds a ranking system to the player",entrypoint:()=>{h.addEventListener("open",()=>{b.info("Socket connection established")}),h.addEventListener("message",t=>{let e=JSON.parse(t.data);b.info(e)}),h.addEventListener("close",()=>{b.info("Socket connection closed")}),h.addEventListener("error",t=>{b.error(t)})}});var w=new Map;w.set(x.name,x);w.set(P.name,P);var E=new l("Observer"),T=()=>{let t=window.location.pathname;new MutationObserver((e,o)=>{window.location.pathname!==t&&(t=window.location.pathname,M(t))}).observe(document,{childList:!0,subtree:!0})},A=()=>{new MutationObserver((t,e)=>{let o=document.querySelector("div.inset-center > div.buttonShine");o&&o.addEventListener("click",()=>{R()})}).observe(document,{childList:!0,subtree:!0})},M=t=>{E.log("New path: "+t)},R=()=>{E.log("Play button clicked")},L=[{name:"pathObserver",associatedFn:T,enabled:!0},{name:"playButtonClicked",associatedFn:A,enabled:!0}];u("div[data-v-733b83fc] > a > svg",t=>{U()});function U(){let t=new l("Loader");t.info("Hello from ReyfmPlus!"),L.forEach(e=>{e.enabled&&(t.info(`Loading observer: ${e.name}`),e.associatedFn())}),w.forEach(e=>{e.enabled&&t.info(`Loading plugin: ${e.name}`)}),window.rfmPlus=window.rfmPlus||N,k(),g(window.location.pathname),B(window.location.pathname,g),u("a[data-v-5fde3039] > div.w-max > p.akira",e=>{let a=e.parentElement?.parentElement,n=c(e,"On Spotify","#1db954",!1,s=>{s.preventDefault(),C()});a.appendChild(n)})}function S(){window.__NUXT__.state.player.audio&&r(window.rfmPlus.state.audioPlayer);let t=location.pathname.split("/")[2],e=O[t];console.log("[REYFMPLUS] Station ID: "+e),console.log("[REYFMPLUS] Bass boost menu for station: "+t),window.__NUXT__.state.player.currentStation=e;let o=`https://listen.reyfm.de/${t}_320kbps.mp3`,a=document.createElement("div");a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.backgroundColor="rgba(0, 0, 0, 0.5)";let n=document.createElement("div");n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.backgroundColor="#ffffff",n.style.padding="20px",n.style.borderRadius="10px",n.style.width="80%",n.style.maxWidth="500px",n.style.height="80%",n.style.maxHeight="500px",n.style.overflow="auto",n.style.boxShadow="0 0 10px 0 rgba(0, 0, 0, 0.5)",n.textContent="REYFMPlus \u2014 Bass Boost Menu",n.style.fontSize="20px",n.style.fontWeight="bold",n.style.textAlign="center",n.style.marginBottom="20px",document.body.appendChild(a),a.appendChild(n),[{name:"Normal",description:"No bass boost",value:0},{name:"Regular Bass Boost",description:"A regular bass boost, nothing fancy",value:1},{name:"Heavy Bass Boost",description:"A heavy bass boost, for the bassheads",value:5},{name:"Bass Boost + Limiter",description:"A regular bass boost with a limiter to prevent clipping",value:3},{name:"Absolutely fucking crazy",description:"A heavy bass boost, why are you even using this",value:15}].forEach(d=>{let i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.marginBottom="20px",i.style.cursor="pointer";let y=document.createElement("div");y.style.fontSize="18px",y.style.fontWeight="bold",y.textContent=d.name;let p=document.createElement("div");p.style.fontSize="14px",p.style.fontWeight="normal",p.style.textAlign="center",p.textContent=d.description,i.appendChild(y),i.appendChild(p),i.addEventListener("click",()=>{X(o,d.value),a.remove()}),n.appendChild(i)}),a.style.display="block",a.addEventListener("click",d=>{d.target===a&&a.remove()})}var O={original:1,nightlife:2,raproyal:3,usrap:4,hitsonly:5,gaming:6,houseparty:7,chillout:8,lofi:9,oldschool:10,mashup:11,charts:12,partyhard:13,bass:14,kpop:15,xmas:20};function X(t="https://listen.reyfm.de/original_320kbps.mp3",e=1){let o=new window.AudioContext,a=new Audio;a.src=t,a.crossOrigin="anonymous";let n=o.createMediaElementSource(a),s=o.createBiquadFilter();s.type="lowshelf",s.frequency.value=1e3,s.gain.value=e,n.connect(s),s.connect(o.destination),window.__NUXT__.state.player.playing=!0,window.__NUXT__.state.player.audio&&r(a),window.rfmPlus.state.audioPlayer=a,window.rfmPlus.state.audioContext=o,window.__NUXT__.state.player.audio=a,f(a)}})();
/*! For license information please see reyfm.user.js.LEGAL.txt */
