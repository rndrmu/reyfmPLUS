// ==UserScript==
// @name         reyfm-plus
// @namespace    https://github.com
// @version      1.0.0
// @description  ReyFM++
// @author       
// @match        https://rey.fm/*
// @grant        none
// ==/UserScript==
(()=>{function u(t,e,o,n,a){let s=t.cloneNode(!0);return s.childNodes[0].textContent=e,s.style.backgroundColor=o,s.style.color="#ffffff",s.style.marginTop=n?"10px":"0px",s.style.paddingLeft="10px",s.style.paddingRight="10px",s.style.borderRadius="10px",s.style.fontSize="12px",s.addEventListener("click",a),s}function m(t,e){new MutationObserver((o,n)=>{let a=document.querySelectorAll(t)[0];a&&a.offsetParent!==null&&(e(a),n.disconnect())}).observe(document,{childList:!0,subtree:!0})}function x(){let t=document.querySelectorAll("p[data-v-5fde3039]")[0].textContent?.trim(),e=document.querySelectorAll("p[data-v-5fde3039]")[1].textContent?.trim(),o=`https://open.spotify.com/search/${t} ${e}`;window.open(o,"_blank")}function P(){let t=document.querySelectorAll("div.base-container")[4],o=t.childNodes[2].cloneNode(!0);o.childNodes[0].textContent="ReyfmPlus",o.querySelector("div > a > p").textContent=`A script to enhance the rey.fm experience

 Version: 1.0`,o.querySelector("div > a > p").innerHTML=o.querySelector("div > a > p").innerHTML.replace(/\n/g,"<br>"),o.querySelector("div > a").removeAttribute("href"),t.insertBefore(o,t.childNodes[5])}function i(t){window.__NUXT__.state.player.audio.pause(),window.__NUXT__.state.player.audio=null,window.__NUXT__.state.player.audio=t,window.__NUXT__.state.player.audio?.play()}function C(t){i(window.__NUXT__.state.player.audio),window.__NUXT__.state.player.audio=t,window.__NUXT__.state.player.playing=!0,window.__NUXT__.state.player.audio.play()}function S(t,e){let o=window.location.pathname;new MutationObserver((n,a)=>{window.location.pathname!==o&&(o=window.location.pathname,g(o))}).observe(document,{childList:!0,subtree:!0})}function g(t){console.log("[REYFMPLUS] New path: "+t),t.startsWith("/station/")&&m("div.name",e=>{let o=e.parentElement,n=e;n.childNodes[0].textContent=n.childNodes[0].textContent+" \u2014 ReyfmPlusEnhanced";let a=u(e,"Bass Boost Menu","#ff0000",!0,()=>{console.log("clicked boost chip"),N()});if(o.appendChild(a),!window.rfmPlus.state.bassBoostActive){let s=u(e,"Bass Boost Active (Lvl: "+window.rfmPlus.state.bassBoostLevel+")","#ff0000",!0,()=>{console.log("clicked boost active chip")});o.appendChild(s)}})}function b(t,e){let o=window.__NUXT__.state.player.audio;window.__NUXT__.state.player.currentStation=t,o.src=`https://listen.reyfm.de/${t}_${e}kbps.mp3`,o.play()}var B={original:1,nightlife:2,raproyal:3,usrap:4,hitsonly:5,gaming:6,houseparty:7,chillout:8,lofi:9,oldschool:10,mashup:11,charts:12,partyhard:13,bass:14,kpop:15,xmas:20};function y(t){return t}var k={state:{bassBoostActive:!1,bassBoostLevel:0},api:{getStation:async t=>{let e=await window.rfmPlus.api.getStations();return B[t]},getStations:async()=>new Promise((t,e)=>{let o=window.__NUXT__.state.main.data.channels;o?t(o):e("Could not get stations")}),playBoosted:async(t,e)=>{window.__NUXT__.state.player.audio&&i(window.rfmPlus.state.audioPlayer),window.rfmPlus.state.bassBoostActive=!0,b(t,e)},playOriginal:async(t,e)=>{window.__NUXT__.state.player.audio&&i(window.rfmPlus.state.audioPlayer),window.rfmPlus.state.bassBoostActive=!1,b(t,e)}}};var l=class{constructor(e,o="white"){this.name=e;this.color=o}static makeTitle(e,o){return["%c %c %s ","",`background: ${e}; color: black; font-weight: bold; border-radius: 5px;`,o]}_log(e,o,n,a=""){console[e](`%c Rey.fm Plus %c %c ${this.name} ${a}`,`background: ${o}; color: black; font-weight: bold; border-radius: 5px;`,"",`background: ${this.color}; color: black; font-weight: bold; border-radius: 5px;`,...n)}log(...e){this._log("log","#a6d189",e)}info(...e){this._log("info","#a6d189",e)}error(...e){this._log("error","#e78284",e)}errorCustomFmt(e,...o){this._log("error","#e78284",o,e)}warn(...e){this._log("warn","#e5c890",e)}debug(...e){this._log("debug","#eebebe",e)}};var _=y({name:"Bass Boost",enabled:!1,author:"built-in",version:"1.0.0",description:"Adds a bass boost button to the player",entrypoint:()=>{let t=document.createElement("button");t.className="btn btn-primary btn-sm",t.innerHTML="Bass Boost",t.addEventListener("click",()=>{let e=document.querySelector("audio");e&&(e.playbackRate=1.5)}),document.querySelector(".player-controls").appendChild(t)}});var d=new l("Socket"),w=y({name:"Ranking System",enabled:!0,author:"built-in",version:"1.0.0",description:"Adds a ranking system to the player",entrypoint:()=>{let t=new WebSocket("ws://localhost:8080");t.addEventListener("open",()=>{d.info("Socket connection established")}),t.addEventListener("message",n=>{let a=JSON.parse(n.data);d.info(a)}),t.addEventListener("close",n=>{d.info("Socket connection closed. Code: %s, Reason: %s",n.code,n.reason),clearInterval(e),clearInterval(o)}),t.addEventListener("error",n=>{d.error(n)});let e=setInterval(()=>{d.info("Sending heartbeat"),t.send(JSON.stringify({type:"heartbeat",data:{timestamp:Date.now()}}))},15e3),o=setInterval(()=>{d.info("Sending play state update"),t.send(JSON.stringify({type:"PlayStateUpdate",data:{timestamp:Date.now(),discord_id:12345679e12,channel_id:"1",listening_delta:30}}))},3e4)}});var h=new Map;h.set(_.name,_);h.set(w.name,w);var E="div.inset-center > div.buttonShine";var v=new l("Observer"),L=()=>{let t=window.location.pathname;new MutationObserver((e,o)=>{window.location.pathname!==t&&(t=window.location.pathname,A(t))}).observe(document,{childList:!0,subtree:!0})},R=()=>{document.querySelector(E).addEventListener("click",()=>{M()})},A=t=>{v.log("New path: "+t)},M=()=>{let t=window.__NUXT__.state.player.audio,e=window.rfmPlus.state.audioPlayer;t&&e?(v.log("Resuming"),window.__NUXT__.state.player.audio=e,window.__NUXT__.state.player.playing=!0):!t&&e&&(v.log("Pausing"),t?.pause(),window.__NUXT__.state.player.audio=null,window.__NUXT__.state.player.playing=!1,e.pause())},T=[{name:"pathObserver",associatedFn:L,enabled:!0},{name:"playButtonClicked",associatedFn:R,enabled:!0}];m("div[data-v-733b83fc] > a > svg",t=>{U()});function U(){let t=new l("Loader");t.info("Hello from ReyfmPlus!"),T.forEach(e=>{e.enabled&&(t.info(`Loading observer: ${e.name}`),e.associatedFn())}),h.forEach(e=>{e.enabled&&(t.info(`Loading plugin: ${e.name}`),e.entrypoint())}),window.rfmPlus=window.rfmPlus||k,P(),g(window.location.pathname),S(window.location.pathname,g),m("a[data-v-5fde3039] > div.w-max > p.akira",e=>{let n=e.parentElement?.parentElement,a=u(e,"On Spotify","#1db954",!1,s=>{s.preventDefault(),x()});n.appendChild(a)})}function N(){window.__NUXT__.state.player.audio&&i(window.rfmPlus.state.audioPlayer);let t=location.pathname.split("/")[2],e=O[t];console.log("[REYFMPLUS] Station ID: "+e),console.log("[REYFMPLUS] Bass boost menu for station: "+t),window.__NUXT__.state.player.currentStation=e;let o=`https://listen.reyfm.de/${t}_320kbps.mp3`,n=document.createElement("div");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.backgroundColor="rgba(0, 0, 0, 0.5)";let a=document.createElement("div");a.style.position="absolute",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.backgroundColor="#ffffff",a.style.padding="20px",a.style.borderRadius="10px",a.style.width="80%",a.style.maxWidth="500px",a.style.height="80%",a.style.maxHeight="500px",a.style.overflow="auto",a.style.boxShadow="0 0 10px 0 rgba(0, 0, 0, 0.5)",a.textContent="REYFMPlus \u2014 Bass Boost Menu",a.style.fontSize="20px",a.style.fontWeight="bold",a.style.textAlign="center",a.style.marginBottom="20px",document.body.appendChild(n),n.appendChild(a),[{name:"Normal",description:"No bass boost",value:0},{name:"Regular Bass Boost",description:"A regular bass boost, nothing fancy",value:1},{name:"Heavy Bass Boost",description:"A heavy bass boost, for the bassheads",value:5},{name:"Bass Boost + Limiter",description:"A regular bass boost with a limiter to prevent clipping",value:3},{name:"Absolutely fucking crazy",description:"A heavy bass boost, why are you even using this",value:15}].forEach(p=>{let r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.marginBottom="20px",r.style.cursor="pointer";let f=document.createElement("div");f.style.fontSize="18px",f.style.fontWeight="bold",f.textContent=p.name;let c=document.createElement("div");c.style.fontSize="14px",c.style.fontWeight="normal",c.style.textAlign="center",c.textContent=p.description,r.appendChild(f),r.appendChild(c),r.addEventListener("click",()=>{X(o,p.value),n.remove()}),a.appendChild(r)}),n.style.display="block",n.addEventListener("click",p=>{p.target===n&&n.remove()})}var O={original:1,nightlife:2,raproyal:3,usrap:4,hitsonly:5,gaming:6,houseparty:7,chillout:8,lofi:9,oldschool:10,mashup:11,charts:12,partyhard:13,bass:14,kpop:15,xmas:20};function X(t="https://listen.reyfm.de/original_320kbps.mp3",e=1){let o=new window.AudioContext,n=new Audio;n.src=t,n.crossOrigin="anonymous";let a=o.createMediaElementSource(n),s=o.createBiquadFilter();s.type="lowshelf",s.frequency.value=1e3,s.gain.value=e,a.connect(s),s.connect(o.destination),window.__NUXT__.state.player.playing=!0,window.__NUXT__.state.player.audio&&i(n),window.rfmPlus.state.audioPlayer=n,window.rfmPlus.state.audioContext=o,window.__NUXT__.state.player.audio=n,C(n)}})();
/*! For license information please see reyfm.user.js.LEGAL.txt */
